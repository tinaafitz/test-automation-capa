---
# vars file for test-autonode-feature
# These are role variables that should not typically be overridden

# ==========================================
# Required CLI Tools
# ==========================================
autonode_required_cli_tools:
  - name: kubectl
    version_command: "kubectl version --client --short 2>/dev/null || echo 'unknown'"
    install_docs: "https://kubernetes.io/docs/tasks/tools/install-kubectl/"
  - name: oc
    version_command: "oc version --client 2>/dev/null || echo 'unknown'"
    install_docs: "https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/getting-started-cli.html"
  - name: aws
    version_command: "aws --version 2>&1"
    install_docs: "https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html"
  - name: rosa
    version_command: "rosa version 2>&1"
    install_docs: "https://docs.openshift.com/rosa/rosa_install_access_delete_clusters/rosa_getting_started_iam/rosa-installing-rosa.html"
  - name: jq
    version_command: "jq --version 2>&1"
    install_docs: "https://stedolan.github.io/jq/download/"

# ==========================================
# IAM Policy Statements
# ==========================================
# These are used by the autonode-policy.json.j2 template
# Defined here for reference and potential future use

autonode_iam_policy_version: "2012-10-17"

# ==========================================
# Karpenter Configuration Constants
# ==========================================
karpenter_namespace: "kube-system"
karpenter_service_account: "karpenter"
karpenter_label_selector: "app.kubernetes.io/name=karpenter"

# ==========================================
# API Versions
# ==========================================
api_versions:
  ec2nodeclass: "karpenter.k8s.aws/v1beta1"
  nodepool: "karpenter.sh/v1beta1"
  rosacontrolplane: "controlplane.cluster.x-k8s.io/v1beta1"

# ==========================================
# Tag Keys
# ==========================================
tag_keys:
  karpenter_discovery: "karpenter.sh/discovery"
  karpenter_nodepool: "karpenter.sh/nodepool"
  karpenter_ec2nodeclass: "karpenter.k8s.aws/ec2nodeclass"
  kubernetes_cluster: "kubernetes.io/cluster/{{ cluster_name }}"

# ==========================================
# Default AWS Regions
# ==========================================
# Supported AWS regions for ROSA
supported_aws_regions:
  - us-east-1
  - us-east-2
  - us-west-1
  - us-west-2
  - eu-central-1
  - eu-west-1
  - eu-west-2
  - eu-west-3
  - ap-northeast-1
  - ap-northeast-2
  - ap-southeast-1
  - ap-southeast-2
  - ap-south-1
  - ca-central-1
  - sa-east-1

# ==========================================
# Instance Type Categories
# ==========================================
# Common instance type categories for easy selection
instance_type_categories:
  general_purpose:
    - m5.large
    - m5.xlarge
    - m5.2xlarge
    - m6i.large
    - m6i.xlarge
    - m6i.2xlarge
  compute_optimized:
    - c5.large
    - c5.xlarge
    - c5.2xlarge
    - c6i.large
    - c6i.xlarge
    - c6i.2xlarge
  memory_optimized:
    - r5.large
    - r5.xlarge
    - r5.2xlarge
    - r6i.large
    - r6i.xlarge
    - r6i.2xlarge
  gpu_instances:
    - g4dn.xlarge
    - g4dn.2xlarge
    - g5.xlarge
    - g5.2xlarge

# ==========================================
# Validation Patterns
# ==========================================
validation_patterns:
  cluster_name_pattern: "^[a-z][a-z0-9-]{0,14}$"  # ROSA cluster name pattern
  aws_account_id_pattern: "^[0-9]{12}$"  # AWS account ID is 12 digits
  oidc_provider_pattern: "^rh-oidc\\.s3\\.[a-z0-9-]+\\.amazonaws\\.com/"

# ==========================================
# Status Check Intervals
# ==========================================
status_check:
  karpenter_pod_ready_interval: 5  # seconds
  nodepool_ready_interval: 3  # seconds
  ec2nodeclass_ready_interval: 5  # seconds
  node_provisioning_interval: 10  # seconds
  node_scaledown_interval: 20  # seconds

# ==========================================
# Test Workload Defaults
# ==========================================
test_workload:
  name: "autonode-scale-test"
  namespace: "default"
  labels:
    app: "autonode-scale-test"
    test: "karpenter-scaling"

# ==========================================
# File Paths
# ==========================================
temp_file_paths:
  policy_file_prefix: "/tmp/AutoNodePolicy"
  trust_policy_prefix: "/tmp/AutoNodeRole"
  ec2nodeclass_prefix: "/tmp/ec2nodeclass"
  nodepool_prefix: "/tmp/nodepool"
  test_deployment: "/tmp/autonode-scale-test-deployment.yaml"
  cluster_info: "/tmp/autonode-cluster-info-{{ cluster_name }}.env"

# ==========================================
# Error Messages
# ==========================================
error_messages:
  cluster_not_ready: "Cluster {{ cluster_name }} is not in 'ready' state. Current state: {{ cluster_info.state }}"
  cluster_not_hcp: "Cluster {{ cluster_name }} is not a Hosted Control Plane cluster"
  cli_tool_missing: "Required CLI tool not found"
  aws_credentials_invalid: "AWS credentials are not configured or invalid"
  rosa_auth_failed: "ROSA authentication failed"
  oidc_provider_missing: "OIDC provider not found for cluster"
  iam_policy_exists: "IAM policy already exists"
  iam_role_exists: "IAM role already exists"
  karpenter_pods_not_running: "Karpenter pods are not running"
  nodepool_not_ready: "NodePool is not ready"
  ec2nodeclass_not_ready: "EC2NodeClass is not ready"
  scaling_test_failed: "Scaling test failed"
  resource_tagging_failed: "Failed to tag AWS resources"

# ==========================================
# Success Messages
# ==========================================
success_messages:
  cluster_ready: "Cluster {{ cluster_name }} is ready"
  cli_tools_validated: "All required CLI tools are installed"
  aws_credentials_valid: "AWS credentials are valid"
  rosa_authenticated: "Successfully authenticated to ROSA"
  iam_policy_created: "IAM policy created successfully"
  iam_role_created: "IAM role created successfully"
  rosacontrolplane_updated: "RosaControlPlane updated with AutoNode configuration"
  resources_tagged: "AWS resources tagged successfully"
  ec2nodeclass_ready: "EC2NodeClass is ready"
  nodepool_ready: "NodePool is ready"
  karpenter_running: "Karpenter pods are running"
  scaling_test_passed: "Scaling test passed"
  cleanup_complete: "Cleanup completed successfully"
