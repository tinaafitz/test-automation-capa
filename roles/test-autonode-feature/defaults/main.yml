---
# defaults file for test-autonode-feature
# These are default values that can be overridden by users

# ==========================================
# Cluster Configuration
# ==========================================
cluster_name: ""  # Required - ROSA HCP cluster name
cluster_namespace: "ns-rosa-hcp"  # Namespace where RosaControlPlane exists
aws_region: "us-east-1"  # AWS region for the cluster

# ==========================================
# AutoNode Configuration
# ==========================================
autonode_mode: "Enabled"  # AutoNode mode: Enabled or Disabled (case-sensitive)
autonode_validate_prerequisites: true  # Run prerequisite validation

# ==========================================
# IAM Configuration
# ==========================================
autonode_policy_name: "AutoNodePolicy-{{ cluster_name }}"
autonode_role_name: "AutoNodeRole-{{ cluster_name }}"
autonode_iam_role_name: "{{ autonode_role_name }}"  # Alias for consistency

# ==========================================
# Karpenter NodePool Configuration
# ==========================================
nodepool_name: "default-nodepool"
nodeclass_name: "default-nodeclass"

# Instance types for Karpenter to use
autonode_instance_types:
  - m5.large
  - m5.xlarge
  - m5.2xlarge
  - m6i.large
  - m6i.xlarge
  - m6i.2xlarge

# Capacity types (on-demand, spot, or both)
autonode_capacity_types:
  - on-demand
  - spot

# Availability zones (empty means all AZs in the region)
autonode_availability_zones: []

# Node labels (optional)
autonode_node_labels: {}

# Node taints (optional)
autonode_node_taints: []

# Resource limits
autonode_max_cpu: "1000"  # Maximum CPU cores to provision
autonode_max_memory: "1000Gi"  # Maximum memory to provision

# Disruption configuration
autonode_consolidation_policy: "WhenUnderutilized"  # WhenUnderutilized or WhenEmpty
autonode_consolidate_after: "30s"  # Time to wait before consolidating
autonode_expire_after: "720h"  # Node expiration time (30 days)
autonode_nodepool_weight: 10  # Scheduling weight for this NodePool

# ==========================================
# EC2NodeClass Configuration
# ==========================================
autonode_volume_size: "100Gi"  # Root volume size
autonode_volume_type: "gp3"  # EBS volume type
autonode_additional_tags: {}  # Additional tags for EC2 instances

# ==========================================
# Scaling Test Configuration
# ==========================================
autonode_test_replicas: 10  # Number of test pods to deploy
autonode_test_cpu: "500m"  # CPU request per test pod
autonode_test_memory: "1Gi"  # Memory request per test pod
autonode_test_cpu_limit: "{{ autonode_test_cpu }}"  # CPU limit per test pod
autonode_test_memory_limit: "{{ autonode_test_memory }}"  # Memory limit per test pod
autonode_test_image: "registry.k8s.io/pause:3.9"  # Container image for test pods
autonode_test_spread_pods: true  # Enable pod anti-affinity
autonode_test_node_selector: {}  # Node selector for test pods (optional)
autonode_test_tolerations: []  # Tolerations for test pods (optional)
autonode_scaling_timeout: 600  # Maximum time (seconds) to wait for scaling

# ==========================================
# Test Behavior Configuration
# ==========================================
autonode_cleanup_test_deployment: true  # Delete test deployment after scaling test
autonode_wait_for_scaledown: false  # Wait for nodes to scale down after test cleanup
autonode_observe_scaling: false  # Pause to observe scaled environment
autonode_cleanup_iam_resources: false  # Delete IAM resources during cleanup (dangerous!)

# ==========================================
# Results and Logging
# ==========================================
autonode_results_dir: "/tmp/autonode-results"  # Directory to save test results
autonode_kubeconfig_path: "/tmp/autonode-{{ cluster_name }}-kubeconfig"  # Dedicated kubeconfig for this cluster

# ==========================================
# AWS Credentials
# ==========================================
# These can be set via environment variables or passed as extra vars
# AWS_ACCESS_KEY_ID: ""
# AWS_SECRET_ACCESS_KEY: ""
# AWS_SESSION_TOKEN: ""  # Optional for temporary credentials

# ==========================================
# Validation Settings
# ==========================================
autonode_validate_cli_tools: true  # Validate required CLI tools are installed
autonode_validate_cluster_ready: true  # Validate cluster is ready
autonode_validate_aws_credentials: true  # Validate AWS credentials
autonode_validate_rosa_auth: true  # Validate ROSA authentication

# ==========================================
# Timeouts and Retries
# ==========================================
autonode_ec2nodeclass_ready_timeout: 100  # Seconds to wait for EC2NodeClass ready
autonode_nodepool_ready_timeout: 30  # Seconds to wait for NodePool ready
autonode_rosacontrolplane_reconcile_timeout: 60  # Seconds to wait for RosaControlPlane reconciliation

# ==========================================
# Feature Flags
# ==========================================
autonode_skip_cleanup: false  # Skip cleanup tasks (for debugging)
autonode_debug_mode: false  # Enable verbose debug output
skip_ocp_login: false  # Skip OCP login (set to true if already logged into hub cluster)
